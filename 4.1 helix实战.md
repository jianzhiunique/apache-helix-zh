```
1. 创建集群
# ./helix-admin.sh --zkSvr <zk_address> --addCluster <clustername>
./helix-admin.sh --zkSvr <zk_address> --addCluster helix-online-offline

2. 添加节点到集群
# helix-admin.sh --zkSvr <zk_address>  --addNode <clustername> <host:port>
./helix-admin.sh --zkSvr <zk_address> --addNode helix-online-offline localhost:12913
./helix-admin.sh --zkSvr <zk_address> --addNode helix-online-offline localhost:12914
./helix-admin.sh --zkSvr <zk_address> --addNode helix-online-offline localhost:12915

Add instance localhost_12913 to cluster helix-online-offline.
Add instance localhost_12914 to cluster helix-online-offline.
Add instance localhost_12915 to cluster helix-online-offline.

3. 定义资源和分区
# helix-admin.sh --zkSvr <zk_address> --addResource <clustername> <resourceName> <numPartitions> <StateModelName>
./helix-admin.sh --zkSvr <zk_address> --addResource helix-online-offline resource_demo 6 OnlineOffline

4. 到这里先看看这个资源的详情
# helix-admin.sh --zkSvr <zk_address> --listResourceInfo <clusterName> <resourceName>
./helix-admin.sh --zkSvr localhost:2199 --listResourceInfo helix-online-offline resource_demo

IdealState for resource_demo:
{
  "id" : "resource_demo",
  "mapFields" : {
  },
  "listFields" : {  //这里还是空的，在rebalance之后就有了
  },
  "simpleFields" : {
    "IDEAL_STATE_MODE" : "AUTO",
    "NUM_PARTITIONS" : "6",
    "REBALANCE_MODE" : "SEMI_AUTO", //默认是自己决定位置，Helix决定副本状态
    "REBALANCE_STRATEGY" : "DEFAULT",
    "REPLICAS" : "0", //这个默认是0，稍后在rebalance时改为1，保证任何时刻都有一个副本运行
    "STATE_MODEL_DEF_REF" : "OnlineOffline",
    "STATE_MODEL_FACTORY_NAME" : "DEFAULT"
  }
}
No externalView for resource_demo

5. 执行一下rebalance
# helix-admin.sh --zkSvr <zk_address> --rebalance <clustername> <resourceName> <replication factor> 副本数参数
./helix-admin.sh --zkSvr localhost:2199 --rebalance helix-online-offline resource_demo 1

IdealState for resource_demo:
{
  "id" : "resource_demo",
  "mapFields" : {
    "resource_demo_0" : {
      "localhost_12914" : "ONLINE"
    },
    "resource_demo_1" : {
      "localhost_12915" : "ONLINE"
    },
    "resource_demo_2" : {
      "localhost_12913" : "ONLINE"
    },
    "resource_demo_3" : {
      "localhost_12915" : "ONLINE"
    },
    "resource_demo_4" : {
      "localhost_12913" : "ONLINE"
    },
    "resource_demo_5" : {
      "localhost_12914" : "ONLINE"
    }
  },
  "listFields" : {
    "resource_demo_0" : [ "localhost_12914" ],
    "resource_demo_1" : [ "localhost_12915" ],
    "resource_demo_2" : [ "localhost_12913" ],
    "resource_demo_3" : [ "localhost_12915" ],
    "resource_demo_4" : [ "localhost_12913" ],
    "resource_demo_5" : [ "localhost_12914" ]
  },
  "simpleFields" : {
    "IDEAL_STATE_MODE" : "AUTO",
    "NUM_PARTITIONS" : "6",
    "REBALANCE_MODE" : "SEMI_AUTO",
    "REBALANCE_STRATEGY" : "DEFAULT",
    "REPLICAS" : "1",
    "STATE_MODEL_DEF_REF" : "OnlineOffline",
    "STATE_MODEL_FACTORY_NAME" : "DEFAULT"
  }
}

No externalView for resource_demo


4. 下面试一下能否手动配置listFields
./helix-admin.sh --zkSvr localhost:2199 --addIdealState <clusterName resourceName <filename>>


5. 启动控制器

6. 启动参与者程序


```

```
1. cluster setup class
创建集群

2. 参与者节点
定义状态机模型
自动添加节点到集群

3.命令行/程序
添加资源

4.设置理想状态
SemiAutoModeISBuilder builder = new SemiAutoModeISBuilder(resourceName);
builder.setStateModel("MasterSlave").setNumPartitions(2).setNumReplica(2);
builder.assignPreferenceList(buildPartitionName(resourceName, 0), "localhost_12918",
"localhost_12919").assignPreferenceList(buildPartitionName(resourceName, 1),
"localhost_12919", "localhost_12918");

idealState = builder.build();
admin.addResource(clusterName, resourceName, idealState);
```

